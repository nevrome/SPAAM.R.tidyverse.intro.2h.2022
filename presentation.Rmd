---
title: "A crash course on R for data analysis"
author: "Clemens Schmid"
date: "2019/06/05"
fontsize: 9pt
output:
  beamer_presentation:
    includes: 
      in_header: preamble.tex
    keep_tex: true
classoption: "aspectratio=169"
fig_caption: yes
editor_options: 
  chunk_output_type: console
---

```{r, echo = FALSE}
# https://stackoverflow.com/questions/25646333/code-chunk-font-size-in-rmarkdown-with-knitr-and-latex
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, cache = FALSE, results = FALSE, warning = FALSE, message = FALSE)
```

## TOC

- The working environment?
- Loading data?

# The working environment?

## A crash course on R for data analysis

- R is a fully featured programming language, but it excels as an environment for (statistical) data analysis

- RStudio ...

- The Tidyverse is ...

# Loading data

## Reading data with readr

```{r echo = FALSE}
sample_table_url <- "https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/b187df6ebd23dfeb42935fd5020cb615ead3f164/ancientmetagenome-hostassociated/samples/ancientmetagenome-hostassociated_samples.tsv"
library_table_url <- "https://raw.githubusercontent.com/SPAAM-community/AncientMetagenomeDir/b187df6ebd23dfeb42935fd5020cb615ead3f164/ancientmetagenome-hostassociated/libraries/ancientmetagenome-hostassociated_libraries.tsv"
```

- With R we usually operate on data in our computer's memory
- The tidyverse provides the package `readr` to read data from text files into the memory
- `readr` can read from our file system or the internet
- It provides functions to read data in almost any (text) format:

```{r eval=FALSE}
readr::read_csv()   # .csv files
readr::read_tsv()   # .tsv files
readr::read_delim() # tabular files with an arbitrary separator
readr::read_fwf()   # fixed width files
readr::read_lines() # read linewise to parse yourself 
```

- `readr` automatically detects column types - or your define them manually

## The interface of `read_csv` work?

- We can learn more about a function with the `?` to open its help file: `?readr::read_csv`
- `readr::read_csv` has many options to specify how to read a text file

```{r eval=FALSE}
read_csv(
  file,                      # The path to the file we want to read
  col_names = TRUE,          # Are there column names?
  col_types = NULL,          # Which types do the columns have? NULL -> auto
  locale = default_locale(), # How is information encoded in this file?
  na = c("", "NA"),          # Which values mean "no data"
  trim_ws = TRUE,            # Should superfluous white-spaces be removed?
  skip = 0,                  # Skip X lines at the beginning of the file
  n_max = Inf,               # Only read X lines
  skip_empty_rows = TRUE,    # Should empty lines be ignored? 
  comment = "",              # Should comment lines be ignored?
  name_repair = "unique",    # How should "broken" column names be fixed
  ...
)
```

## What does `readr` produce? The tibble!

```{r}
my_data <- readr::read_tsv(sample_table_url)
```

- The `tibble` is a "data frame", a tabular data structure with rows and columns
- Unlike a simple array, each column can have another data type

```{r results='markup'}
print(my_data, n = 3)
```

## huhu

```{r echo=FALSE}
# sample_df <- readr::read_tsv(sample_table_url)
# library_df <- readr::read_tsv(library_table_url)
# 
# sample_df$project_name %>% unique %>% length
# library_df$project_name %>% unique %>% length
# 
# colnames(sample_df)
# purrr::map(sample_df, class)
# 
# dim(sample_df)
# 
# head(sample_df)
# tail(sample_df)
# 
# sample_df %>%
#   dplyr::slice_sample(n = 5)
# 
# sample_df[9,]
# sample_df[c(10,12),]
# 
# sample_df[9:12, 0:4]
# 
# sample_df["site_name"]
# sample_df[["site_name"]]
# sample_df$site_name
# 
# sample_df[-1,]
# sample_df[,-1]
# 
# is.na(sample_df)
# sum(sample_df[,2], na.rm = T)
# 
# summary(sample_df)
```
